
function viewMap(d,l,j,k){var h=d;var a=new google.maps.LatLngBounds();var g,f;var m=false;for(f=0;f<h.length;f++){if(h[f][1]>0&&h[f][2]>0){if(m==false){m=true}g=new google.maps.Marker({position:new google.maps.LatLng(h[f][1],h[f][2]),map:map});markers.push(g);a.extend(g.position);var c=new google.maps.InfoWindow();if(j==1){c.setContent(h[f][0]);c.open(map,g)}google.maps.event.addListener(g,"click",(function(n,o){return function(){c.setContent(h[o][0]);c.open(map,n)}})(g,f))}}if(m){$("#overlay_page").addClass("show-overlay");$("#modal_view_map").addClass("show-modal");$(".close-modal").click(function(){DeleteMarkers();$("#overlay_page").removeClass("show-overlay");$("#modal_view_map").removeClass("show-modal");map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].clear()});setTimeout(function(){if(map_resize==true){google.maps.event.trigger(map,"resize");map_resize=false}map.fitBounds(a);if(h.length==1){var i=google.maps.event.addListener(map,"idle",function(){if(map.getZoom()>l){map.setZoom(l)}google.maps.event.removeListener(i)})}},50);var b=document.createElement("div");b.ClassNames="gsmnoprint gm-style-cc";b.style.margin="10px 10px 10px 10px";b.style.position="absolute";b.style.display="block";var e=new MyLocationControl(b,a,d,k);map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(b);$("#lightbox").removeClass("lightbox-hide");$("body").addClass("show-lightbox")}return m}function MyLocationControl(b,f,c,a){var e=document.createElement("div");e.style.backgroundColor="#fff";e.style.border="2px solid #fff";e.style.borderRadius="2px";e.style.boxShadow="0 2px 6px rgba(0,0,0,.3)";e.style.cursor="pointer";e.title="Xem vị trí của bạn";b.appendChild(e);var d=document.createElement("img");d.style.color="rgb(25,25,25)";d.style.padding="0";d.style.width="25px";d.src=img_url+"public/images/radio-checked.svg";d.style.overflow="hidden";d.style.display="block";e.style.display="block";e.style.textAlign="center";e.style.right="0px";e.style.left="0px";e.style.top="0px";e.style.bottom="0px";e.appendChild(d);e.style.position="relative";google.maps.event.addDomListener(e,"click",function(){myLocation(f,c,a)})}function myLocation(c,b,a){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(d){getSurroundingPoint(b,d.coords.latitude,d.coords.longitude,a);console.log(map.getZoom())},function(){handleNoGeolocation(true)})}else{handleNoGeolocation(false)}}function handleNoGeolocation(b){if(b){var c="Lỗi: Vui lòng bật tính năng xác định vị trí (GPS)"}else{var c="Lỗi: Trình duyệt của bạn không hỗ trợ tính năng xác định vị trí."}var a={map:map,position:map.getCenter(),content:c};var d=new google.maps.InfoWindow(a)}function DeleteMarkers(){for(var a=0;a<markers.length;a++){markers[a].setMap(null)}markers=[]}function getSurroundingPoint(e,r,k,o){var t,s,p;var n=[];for(s=0;s<e.length;s++){t=getDistance(r,k,e[s][1],e[s][2]);n.push([e[s][0],e[s][1],e[s][2],Math.round(t*1000)])}n.sort(function(i,d){return d[3]-i[3]});var f=n.length;var h=0;if(f){h=n[f-1][3]}var q=h+o;var g=new google.maps.LatLngBounds();var m=new google.maps.LatLng(r,k);markerMyLocation=new google.maps.Marker({position:m,map:map,icon:"/public/images/my-location.svg"});markers.push(markerMyLocation);var l=new google.maps.InfoWindow();l.setContent("Vị trí hiện hành của bạn");l.open(map,markerMyLocation);g.extend(markerMyLocation.position);var b,u,v,a,c;for(s=0;s<n.length;s++){u=n[s][1];v=n[s][2];iDTemp=n[s][3];if(iDTemp<=q){for(var p=0;p<markers.length;p++){a=markers[p].position.lat();c=Math.round(markers[p].position.lng()*10000000)/10000000;if(u==a&&v==c){g.extend(markers[p].position)}}}else{}}map.fitBounds(g)}function getDistance(f,i,e,h){var g=6371;var k=(e-f)*Math.PI/180;var b=(h-i)*Math.PI/180;var m=Math.sin(k/2)*Math.sin(k/2)+Math.cos(f*Math.PI/180)*Math.cos(e*Math.PI/180)*Math.sin(b/2)*Math.sin(b/2);var l=2*Math.asin(Math.sqrt(m));var j=g*l;return j};